# 微服务

### 步骤

#### 约定 > 配置 > 编码

1、建module

2、改pom

3、写YML

4、主启动

5、业务类

RestTemplate提供了多种便捷访问远程Http服务的方法，是一种简单便捷的访问restful服务模板类，是

spring提供的用于访问Rest服务的**客户端模板**工具集

### Eureka

什么是服务治理？

什么是服务注册？

创建7001服务注册中心

修改pom文件

```java
<dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
            <version>3.1.3</version>
</dependency>
```

写yml

```java
eureka:
  instance:
    hostname: 127.0.0.1  #eureka服务实例名称
  client:
    #false表示不向注册中心注册自己
    register-with-eurka: false
    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务
    fetch-register: false
    service-url:
        #设置与eureka server交互的地址查询服务和注册服务都需要依赖的地址
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka
#         defaultZone: http://127.0.0.1:7001/eureka
```

主启动

```java
@EnableEurekaServer
```

服务提供者8001

修改pom文件

```java
<dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
            <version>3.1.3</version>
</dependency>
```

写yml

```java
eureka:
  client:
    #false表示不向注册中心注册自己
    register-with-eurka: true
    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务
    fetch-register: true
    service-url:
        #设置与eureka server交互的地址查询服务和注册服务都需要依赖的地址
      defaultZone: http://127.0.0.1:7001/eureka
```

主启动

```java
@EnableEurekaClient
```

服务消费者80

修改pom文件

```java
<dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
            <version>3.1.3</version>
</dependency>
```

写yml

```java
eureka:
  client:
    #false表示不向注册中心注册自己
    register-with-eurka: true
    #false表示自己端就是注册中心，我的职责就是维护服务实例，并不需要去检索服务
    fetch-register: true
    service-url:
        #设置与eureka server交互的地址查询服务和注册服务都需要依赖的地址
      defaultZone: http://127.0.0.1:7001/eureka
```

主启动

```java
@EnableEurekaClient
```

集群版

在8001和8002中相互守望，相互调用，在c:...hosts下进行映射

在80中将地址绑定微服务的暴露名称，并且在RestTempt上进行@LoadBalanced负载均衡能力

### actuator配置：

pom中spring-boot-starter-web和spring-boot-starter-actuator标配

在8001yml中

```java
instance:
	instance-id: payment8001
```

ip提示：

```java
instance:
	instance-id: payment8001
    prefer-ip-address: true
```

